#!/usr/bin/bpftrace


tracepoint:block:block_bio_queue
{
	@start[args->sector] = nsecs;
}

tracepoint:block:block_rq_complete,
tracepoint:block:block_bio_complete
/@start[args->sector]/
{
	$usecs = (nsecs - @start[args->sector]) / 1000;

	if ( $usecs > 1000000 ) {
	//cat("/proc/%d/cmdline",pid);
	printf("%s \n", comm);
	}

	delete(@start[args->sector]);
}