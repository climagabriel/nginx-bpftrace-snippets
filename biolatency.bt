#!/usr/bin/bpftrace


tracepoint:block:block_bio_queue
{
	@start[args->sector] = nsecs;
}

tracepoint:block:block_rq_complete,
tracepoint:block:block_bio_complete
/@start[args->sector]/
{
	@usecs = hist((nsecs - @start[args->sector]) / 1000);
	delete(@start[args->sector]);
}